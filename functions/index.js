!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=17)}([function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("firebase-admin")},function(e,t){e.exports=require("lodash/remove")},function(e,t){e.exports=require("lodash/intersectionBy")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("lodash/flatten")},function(e,t){e.exports=require("md5")},function(e){e.exports={type:"service_account",project_id:"fancycrazy-895ba",private_key_id:"2f62366df5c054c3ad2fadc673edc67aa7e0b9b2",private_key:"-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC1oPJJO8P1OyZW\nXgZlgql14wohg7kgs3MmMGQwER6a89A2JncYIdslD7ZlRCPrf9dhUQm1bIJfZsKA\n6aEEd7TXM1ji6p9vPeoqOfQDQFMh2bZn6iCqDhJCJuHKA/Qh9b3w15t/jUowHw/O\nOfApnupI8Qg1oNn/KBZyUWw34UchFjEJbXmD71UT7c6VmsZI5RwxslWkXfnLKmQ2\npAjt/XKlZHaf13OzzBsTt7qf8u3fBDlaOu6RubT0T0N1w6OZyeeLVSc1HF9WrU4F\nmIeOd+C5hjVMQeclb/0nGUMcYDktIv1/u/+H7FmhegV9pR1bkaceoN0rw5eHczjs\nn31u7jsBAgMBAAECggEAApGvO6fzwqE+jpQv5PmvKfK3LvgtAzBmnZCrqh5j3285\nb7qljprT/bc2LkKDe45IXqEF0SIiyfSrJaWoWGbVEQIx7KvC65DloglF0VH0mxL4\nSIoAQkeGrJbeNLxPlLdkI2b5VRmLhhi6YYFiS0RrLfLy2cdXrgtEHgPW0weFuQsQ\nJccpGM5Ssyb6C7uC8x2LN+DtiAxgjMDELz8c1lMq1mKN6UP5H4/0p+pNK5ddmXAD\nA6NuM+ICAvqeGdJfNRlbSCmg0tD+6EoXDESJ+xHmxOXMf7CxNsPnMgdsV10s6q9J\nkxQ13/anfyVc2etr/9bsWE8Oh/3KiRJuI8TLyae/fQKBgQD5+JzUVSznTaP0aWL7\nEoe70MWudM+zYB9cE5ZJBI5zrK20gkRgMfKlap9/tj88SIjis1gU+/0G6hZyZgrC\nTXmxEujCA/v/40V7lODQucrZ9nIJs1ydWfAoc0rYs7ejnxKUahzLZOYBQp6S8Hn0\nbT+p0jZZRAoY2RYOVT48J7szTwKBgQC6Al6gOJXT0odhkj47tl3WLp99xLUMY3/d\nVCDIE2iZd+pRffx2OXlLuEuSfDHYlKfzm3DXA1B0U4GzZBizDKQPY3XJ3g1k5S8d\nu6vFTI/MRYujUMPmQEhVaVk4wkSJcUmBAlmfyoHwCZAOgPEwUKeMSP3ApaIm5m8O\n66BXhb1YrwKBgGojQNv7ioRv+ATIVqnKtW1u+PDZUnOUhdw/yNkaIS5GjL8PbN73\ndlL8UdsVVAZRuiWgBu9qC4bLEFrkrv7PjLM+FyyCKpb9NjyB+29E5DfmJ4es6884\nJ/vU8FvQ+1FzMp1n7PAD2JGCavhzOSUq2hROWJtQg4UHcBEH6tP5/seLAoGAJxxg\ncSf0uPlHZgit9Tg/Os3K01MNDnHNbOhHjEoocDx6lG/9KY6kJnu1yDM89+Ep/1rr\nuwoDXLJCT0n4t40s4d9z4OJDxrc51PKlB3M1uSnWVpyg1EUn8G2aSQjwCEY9wlaQ\nKb0W3TXliGcsT5Bl6mVelac+FRfWujhpGn4QdhkCgYBGtPtv7a8GOMlIrb1gYWSF\nfHI2Qrc2vvNiHNgGUEz9VoH0TcWwKp2O0CIj7RNXidYdQqDqI5OdXnkT+SWLrK25\nOIr3/EG+k8hdtRChxMYi0NuMcNTCritEi8ZoHbBb7SFZfb/KT2wdWh6SFQA/xq6h\nJKyMhCxkA4VWb8yYgu/FCg==\n-----END PRIVATE KEY-----\n",client_email:"firebase-adminsdk-c73dr@fancycrazy-895ba.iam.gserviceaccount.com",client_id:"100431285598293605980",auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://accounts.google.com/o/oauth2/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-c73dr%40fancycrazy-895ba.iam.gserviceaccount.com"}},function(e,t){e.exports=require("shopify-api-node")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t){e.exports=require("express-cache-controller")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("firebase-functions")},function(e,t,r){"use strict";r.r(t);var n,o,i,c,u,a,s,l,p=r(0),f=r.n(p),d=r(1),y=r.n(d),h=r(16),v=r(15),b=r.n(v),g=r(14),m=r.n(g),x=r(13),w=r.n(x),O=r(12),P=r.n(O),A=r(11),j=r.n(A),k=r(10),C=r.n(k),G=r(9),E=r.n(G),q=r(2),D=r.n(q),S=r(8),_=r(7),K=r.n(_),M=r(3),I=r.n(M),L=r(6),Q=r.n(L),B=r(5),J=r.n(B),z=r(4),T=r.n(z);function N(e,t,r,n,o){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}D.a.initializeApp({credentials:D.a.credential.cert(S),databaseURL:"https://fancycrazy-895ba.firebaseio.com"});var U=new E.a({shopName:"cubachtung.myshopify.com",apiKey:"fbe0d0ae67119ada8e18e0bdfcfb4eb3",password:"7f6a7e330da245f0049ff3a642e3abdc"}),Z=D.a.database(),R=Z.ref("server/cache"),V=Z.ref("server/cacheMap"),Y=function(e){return new Promise(function(t){var r=K()(e);V.once("value",function(n){n.hasChild(r)?t(r):V.child(r).set(e).then(function(){t(r)})})})},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;return function(t,r,n){var o=n.value;return"function"==typeof o&&(n.value=y()(f.a.mark(function t(){for(var n=arguments.length,i=Array(n),c=0;c<n;c++)i[c]=arguments[c];var u,a;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y(r+"?"+JSON.stringify(i));case 2:return u=t.sent,t.next=5,new Promise(function(e){R.child(u).once("value",function(t){return e(t.exists()?t.val():null)})});case 5:if(null===(a=t.sent)){t.next=8;break}return t.abrupt("return",Promise.resolve(a.value));case 8:return t.abrupt("return",o.apply(this,i).then(function(t){return new Promise(function(r){return R.child(u).update({value:t,expiration:1e3*e,createdAt:(new Date).getTime()}).then(function(){return r(t)})})}));case 9:case"end":return t.stop()}},t,this)}))),n}},H=(n=W(),o=W(),i=W(),c=W(),u=W(),a=W(),s=W(),N((l=function(){function e(){j()(this,e)}return C()(e,[{key:"_refineProductList",value:function(e){return e.map(function(e){if(e.images&&(e.images=e.images.map(function(e){return e.src})),e.variants){var t=e.variants[0];null!==t.compare_at_price?e.prices={original:100*t.compare_at_price,sale:100*t.price}:e.prices={original:100*t.price},delete e.variants}return e})}},{key:"productGetCollects",value:function(e){return U.collect.list({product_id:e,fields:"collection_id,product_id"})}},{key:"productGet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return U.product.get(e,t)}},{key:"productList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return U.product.list(P()({ids:e.join(",")},t)).then(this._refineProductList)}},{key:"productSimilar",value:function(){var e=y()(f.a.mark(function e(t){var r,n,o,i,c,u=this;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.productGetCollects(t);case 2:return r=e.sent,e.next=5,Promise.all(r.map(function(){var e=y()(f.a.mark(function e(t){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="id,handle",e.next=3,u.collectionGet(t.collection_id,{fields:r});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,u)}));return function(t){return e.apply(this,arguments)}}()));case 5:return n=e.sent,o=I()(n,function(e){return/^(best-selling|newest)/.test(e.handle)}),I()(o,function(e){return!/^best-selling/.test(e.handle)}),e.t0=J.a,e.t1=Q.a,e.next=12,Promise.all(n.map(function(e){return u.collectionGetProducts(e.id,{fields:"id,title,handle,images,variants"})}));case 12:if(e.t2=e.sent,e.t3=(0,e.t1)(e.t2),i=(0,e.t0)(e.t3,"id"),Array.isArray(o)&&0!==o.length){e.next=17;break}return e.abrupt("return",i);case 17:return e.next=19,this.collectionGetProducts(o[0].id,{fields:"id,title,handle,images"});case 19:return c=e.sent,e.abrupt("return",T()(i,c,"id"));case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"collectionGet",value:function(){var e=y()(f.a.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,U.smartCollection.get(t,r);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.next=10,U.customCollection.get(t,r);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},{key:"collectionGetCollects",value:function(e){return U.collect.list({collection_id:e,fields:"collection_id,product_id"})}},{key:"collectionGetProducts",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.collectionGetCollects(e).then(function(e){return e.map(function(e){return e.product_id})}).then(function(e){return t.productList(e,r)})}},{key:"api",get:function(){return U}}]),e}()).prototype,"productGetCollects",[n],Object.getOwnPropertyDescriptor(l.prototype,"productGetCollects"),l.prototype),N(l.prototype,"productGet",[o],Object.getOwnPropertyDescriptor(l.prototype,"productGet"),l.prototype),N(l.prototype,"productList",[i],Object.getOwnPropertyDescriptor(l.prototype,"productList"),l.prototype),N(l.prototype,"productSimilar",[c],Object.getOwnPropertyDescriptor(l.prototype,"productSimilar"),l.prototype),N(l.prototype,"collectionGet",[u],Object.getOwnPropertyDescriptor(l.prototype,"collectionGet"),l.prototype),N(l.prototype,"collectionGetCollects",[a],Object.getOwnPropertyDescriptor(l.prototype,"collectionGetCollects"),l.prototype),N(l.prototype,"collectionGetProducts",[s],Object.getOwnPropertyDescriptor(l.prototype,"collectionGetProducts"),l.prototype),l);r.d(t,"s",function(){return ee});var F,X=new H,$=b()();$.use(m()()),$.use(w()({maxAge:3600})),$.get("/products/:id/similar",(F=y()(f.a.mark(function e(t,r){var n,o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,X.productSimilar(n);case 3:o=e.sent,t.query.top&&(o=o.slice(0,1*t.query.top)),r.json(o);case 6:case"end":return e.stop()}},e,void 0)})),function(e,t){return F.apply(this,arguments)}));var ee=h.https.onRequest($)}])});